{% extends "base.html" %}
{% block content %}
<h2 class="mb-4">Faturamento</h2>

<!-- Seção 1: Gerar Cálculos -->
<div class="card mb-3">
  <div class="card-header bg-primary text-white">Gerar Cálculos</div>
  <div class="card-body">
    <form id="formCalculo">
      <div class="mb-3">
        <label for="shopping1" class="form-label">Selecione o Shopping</label>
        <select id="shopping1" class="form-select">
          <option value="">-- Escolha --</option>
          <option value="Shopping da Ilha">Shopping da Ilha</option>
          <option value="Shopping Mestre Álvaro">Shopping Mestre Álvaro</option>
          <option value="Shopping Moxuara">Shopping Moxuara</option>
        </select>
      </div>
      <div class="mb-3">
        <label for="tipo1" class="form-label">Tipo de Faturamento</label>
        <select id="tipo1" class="form-select">
          <option value="">-- Escolha --</option>
          <option value="Mensal">Mensal</option>
          <option value="Extraordinário">Extraordinário</option>
        </select>
      </div>
      <button class="btn btn-success" type="submit">Gerar Cálculos</button>
    </form>
  </div>
</div>

<!-- Seção 2: Gerar Boletos -->
<div class="card mb-3">
  <div class="card-header bg-warning text-dark">Gerar Boletos</div>
  <div class="card-body">
    <form id="formBoletos">
      <div class="mb-3">
        <label for="shopping2" class="form-label">Selecione o Shopping</label>
        <select id="shopping2" class="form-select">
          <option value="">-- Escolha --</option>
          <option value="Shopping da Ilha">Shopping da Ilha</option>
          <option value="Shopping Mestre Álvaro">Shopping Mestre Álvaro</option>
          <option value="Shopping Moxuara">Shopping Moxuara</option>
        </select>
      </div>
      <div class="mb-3">
        <label for="tipo2" class="form-label">Tipo de Faturamento</label>
        <select id="tipo2" class="form-select">
          <option value="">-- Escolha --</option>
          <option value="Mensal">Mensal</option>
          <option value="Extraordinário">Extraordinário</option>
        </select>
      </div>
      <button class="btn btn-warning" type="submit">Gerar Boletos</button>
    </form>
  </div>
</div>

<!-- Seção 3: Enviar Boletos -->
<div class="card">
  <div class="card-header bg-success text-white">Enviar Boletos</div>
  <div class="card-body">
    <form id="formEnvio">
      <div class="mb-3">
        <label for="shopping3" class="form-label">Selecione o Shopping</label>
        <select id="shopping3" class="form-select">
          <option value="">-- Escolha --</option>
          <option value="Shopping da Ilha">Shopping da Ilha</option>
          <option value="Shopping Mestre Álvaro">Shopping Mestre Álvaro</option>
          <option value="Shopping Moxuara">Shopping Moxuara</option>
        </select>
      </div>
      <div class="mb-3">
        <label for="tipo3" class="form-label">Tipo de Faturamento</label>
        <select id="tipo3" class="form-select">
          <option value="">-- Escolha --</option>
          <option value="Mensal">Mensal</option>
          <option value="Extraordinário">Extraordinário</option>
        </select>
      </div>
      <button class="btn btn-primary" type="submit">Enviar Boletos</button>
    </form>
  </div>
</div>

<script>
async function sendCommand(url) {
  try {
    const resp = await fetch(url);
    alert(await resp.text());
  } catch (err) {
    alert('Erro: ' + err);
  }
}

document.getElementById('formCalculo').addEventListener('submit', e => {
  e.preventDefault();
  const s = shopping1.value, t = tipo1.value;
  if (!s || !t) return alert('Preencha tudo.');
  sendCommand(`/start_faturamento?acao=calculo&shopping=${s}&tipo=${t}`);
});

document.getElementById('formBoletos').addEventListener('submit', e => {
  e.preventDefault();
  const s = shopping2.value, t = tipo2.value;
  if (!s || !t) return alert('Preencha tudo.');
  sendCommand(`/start_faturamento?acao=boletos&shopping=${s}&tipo=${t}`);
});

document.getElementById('formEnvio').addEventListener('submit', e => {
  e.preventDefault();
  const s = shopping3.value, t = tipo3.value;
  if (!s || !t) return alert('Preencha tudo.');
  sendCommand(`/start_faturamento?acao=envio&shopping=${s}&tipo=${t}`);
});
</script>
{% endblock %}
